<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>İletişim Testi - Typo</title>
  <meta name="description" content="Typo İletişim Kişilik Testi - İletişim tarzını keşfet." />
  <meta property="og:site_name" content="Typo" />
  <link rel="icon" href="../assets/app_icon.png" />
  <link rel="preload" href="../assets/fonts/lora/Lora-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="../assets/fonts/montserrat/Montserrat-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="stylesheet" href="../site.css" />
  <style>
    /* IPC Test Specific Styles */
    .test-container {
      min-height: calc(100vh - 200px);
      display: flex;
      flex-direction: column;
    }

    /* Progress Bar */
    .progress-wrapper {
      padding: 16px 0;
      position: sticky;
      top: 60px;
      background: var(--bg);
      z-index: 5;
    }
    .progress-track {
      height: 6px;
      background: rgba(181, 106, 85, 0.2);
      border-radius: 3px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 3px;
      transition: width 0.4s ease;
      width: 0%;
    }
    .progress-text {
      text-align: center;
      font-size: 14px;
      color: var(--fg);
      margin-top: 8px;
      opacity: 0.7;
    }

    /* Question Area */
    .question-area {
      flex: 1;
      padding: 24px 0;
      position: relative;
      overflow: hidden;
    }

    .question-slide {
      animation: slideIn 0.3s ease forwards;
    }
    .question-slide.slide-out-left {
      animation: slideOutLeft 0.25s ease forwards;
    }
    .question-slide.slide-out-right {
      animation: slideOutRight 0.25s ease forwards;
    }
    .question-slide.slide-in-left {
      animation: slideInLeft 0.3s ease forwards;
    }

    @keyframes slideIn {
      from { transform: translateX(60px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutLeft {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(-60px); opacity: 0; }
    }
    @keyframes slideOutRight {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(60px); opacity: 0; }
    }
    @keyframes slideInLeft {
      from { transform: translateX(-60px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .scenario-text {
      font-family: 'Lora', serif;
      font-size: clamp(22px, 4vw, 28px);
      font-weight: 600;
      color: var(--fg);
      line-height: 1.4;
      margin-bottom: 32px;
    }

    .choices-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .choice-card {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 20px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 80px;
    }
    .choice-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    .choice-card:active {
      transform: translateY(0);
    }

    .choice-text {
      font-size: 15px;
      color: var(--fg);
      line-height: 1.5;
      flex: 1;
    }

    .choice-circle {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--bg);
      flex-shrink: 0;
    }

    /* Navigation */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      padding: 24px 0;
      border-top: 1px solid var(--border);
      margin-top: auto;
    }

    .nav-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--card);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    .nav-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }
    .nav-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .nav-btn svg {
      width: 24px;
      height: 24px;
      stroke: var(--fg);
      stroke-width: 2;
      fill: none;
    }

    /* Email Collection Modal */
    .email-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }
    .email-modal.active {
      display: flex;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .email-card {
      background: var(--card);
      border-radius: 24px;
      padding: 40px;
      max-width: 480px;
      width: 100%;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .email-card h2 {
      font-family: 'Lora', serif;
      font-size: 24px;
      margin: 0 0 12px;
    }
    .email-card p {
      color: var(--fg);
      opacity: 0.8;
      margin: 0 0 24px;
      font-size: 15px;
    }

    .email-input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 16px;
      font-family: inherit;
      margin-bottom: 16px;
      transition: border-color 0.2s;
    }
    .email-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .email-btn {
      width: 100%;
      padding: 14px 24px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 999px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 12px;
    }
    .email-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .skip-btn {
      background: none;
      border: none;
      color: var(--fg);
      opacity: 0.6;
      cursor: pointer;
      font-size: 14px;
      padding: 8px;
    }
    .skip-btn:hover {
      opacity: 1;
      text-decoration: underline;
    }

    /* Results Section */
    .results-container {
      display: none;
      text-align: center;
      padding: 40px 0;
      animation: fadeIn 0.5s ease;
    }
    .results-container.active {
      display: block;
    }

    .result-icon {
      width: 120px;
      height: 120px;
      margin: 0 auto 24px;
    }
    .result-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .result-subtitle {
      font-size: 14px;
      color: var(--primary);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin: 0 0 8px;
    }

    .result-title {
      font-family: 'Lora', serif;
      font-size: clamp(32px, 5vw, 42px);
      color: var(--fg);
      margin: 0 0 32px;
    }

    .result-scores {
      display: flex;
      gap: 24px;
      justify-content: center;
      margin-bottom: 32px;
      flex-wrap: wrap;
    }

    .score-item {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px 32px;
      min-width: 180px;
    }
    .score-label {
      font-size: 13px;
      color: var(--fg);
      opacity: 0.7;
      margin-bottom: 8px;
    }
    .score-bar-container {
      height: 8px;
      background: rgba(181, 106, 85, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }
    .score-bar {
      height: 100%;
      background: var(--primary);
      border-radius: 4px;
      transition: width 1s ease;
    }
    .score-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--fg);
    }

    .result-description {
      font-size: 17px;
      color: var(--fg);
      line-height: 1.7;
      max-width: 600px;
      margin: 0 auto 40px;
      padding: 24px;
      background: var(--card);
      border-radius: 16px;
      border: 1px solid var(--border);
    }

    .result-cta {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 999px;
      padding: 14px 28px;
      font-weight: 700;
      text-decoration: none;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .result-cta:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    /* Start Screen */
    .start-screen {
      text-align: center;
      padding: 60px 20px;
    }
    .start-screen h1 {
      font-family: 'Lora', serif;
      font-size: clamp(28px, 5vw, 40px);
      margin: 0 0 16px;
    }
    .start-screen p {
      font-size: 17px;
      color: var(--fg);
      opacity: 0.8;
      max-width: 500px;
      margin: 0 auto 32px;
    }
    .start-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 999px;
      padding: 16px 32px;
      font-weight: 700;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(181, 106, 85, 0.3);
    }

    .test-info {
      display: flex;
      gap: 24px;
      justify-content: center;
      margin-top: 32px;
      flex-wrap: wrap;
    }
    .test-info-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--fg);
      opacity: 0.7;
    }
    .test-info-item svg {
      width: 20px;
      height: 20px;
      stroke: var(--primary);
    }

    /* Hide test when showing start/results */
    .test-area {
      display: none;
    }
    .test-area.active {
      display: flex;
      flex-direction: column;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .choice-card {
        padding: 16px;
      }
      .choice-text {
        font-size: 15px;
      }
      .nav-btn {
        width: 48px;
        height: 48px;
      }
      .email-card {
        padding: 28px 20px;
      }
      .skip-btn {
        padding: 12px 16px;
        min-height: 44px;
      }
      .score-item {
        min-width: 120px;
        padding: 14px 16px;
      }
      .score-label {
        font-size: 13px;
      }
      .start-screen {
        padding: 40px 16px;
      }
      .bottom-container {
        padding-bottom: max(48px, env(safe-area-inset-bottom));
      }
    }

    @media (max-width: 380px) {
      .choice-card {
        padding: 14px;
      }
      .score-item {
        min-width: 100px;
        padding: 12px;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .question-slide {
        animation: none;
      }
      .question-slide.slide-out-left,
      .question-slide.slide-out-right {
        animation: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="back-btn" href="../index.html" aria-label="Geri">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </a>
      <a class="brand" href="../index.html">
        <img class="brand-logo" alt="Typo" src="../assets/text_logo.png" />
      </a>
      <nav class="nav-links">
        <a href="../index.html">Ana Sayfa</a>
        <a href="../privacy.html">Gizlilik</a>
        <a href="../terms.html">Koşullar</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
      <h1>İletişim Kişilik Testi</h1>
      <p>Bu test, kişilerarası iletişim tarzını keşfetmene yardımcı olacak. Senaryolara verdiğin cevaplarla iletişim profilini belirle.</p>
      <button class="start-btn" onclick="startTest()">
        Teste Başla
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </button>
      <div class="test-info">
        <div class="test-info-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <span>~5 dakika</span>
        </div>
        <div class="test-info-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg>
          <span>26 soru</span>
        </div>
        <div class="test-info-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
          <span>Anonim</span>
        </div>
      </div>
    </div>

    <!-- Test Area -->
    <div class="test-container test-area" id="testArea">
      <!-- Progress Bar -->
      <div class="progress-wrapper">
        <div class="progress-track">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text"><span id="currentQ">1</span> / <span id="totalQ">26</span></div>
      </div>

      <!-- Question Area -->
      <div class="question-area" id="questionArea">
        <!-- Questions will be dynamically inserted here -->
      </div>

      <!-- Navigation Buttons -->
      <div class="nav-buttons">
        <button class="nav-btn" id="prevBtn" onclick="goToPrevious()" disabled>
          <svg viewBox="0 0 24 24">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <button class="nav-btn" id="nextBtn" onclick="goToNext()" style="visibility: hidden;">
          <svg viewBox="0 0 24 24">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Results Container -->
    <div class="results-container" id="resultsContainer">
      <div class="result-icon" id="resultIcon">
        <!-- Icon will be inserted here -->
      </div>
      <p class="result-subtitle">İletişim Tarzın</p>
      <h1 class="result-title" id="resultTitle">—</h1>
      <div class="result-scores">
        <div class="score-item">
          <div class="score-label">Baskınlık (Dominance)</div>
          <div class="score-bar-container">
            <div class="score-bar" id="domBar" style="width: 50%"></div>
          </div>
          <div class="score-value" id="domValue">0</div>
        </div>
        <div class="score-item">
          <div class="score-label">Sıcaklık (Warmth)</div>
          <div class="score-bar-container">
            <div class="score-bar" id="lovBar" style="width: 50%"></div>
          </div>
          <div class="score-value" id="lovValue">0</div>
        </div>
      </div>
      <p class="result-description" id="resultDescription">—</p>
      <a href="../index.html" class="result-cta">
        Typo'yu Keşfet
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </main>

  <!-- Email Modal -->
  <div class="email-modal" id="emailModal">
    <div class="email-card">
      <h2>Sonuçlarını Kaydet</h2>
      <p>E-posta adresini girerek sonuçlarını kaydedebilirsin. Typo uygulamasına aynı e-posta ile giriş yaparsan, sonuçların otomatik olarak profiline eklenecek.</p>
      <input type="email" class="email-input" id="emailInput" placeholder="ornek@email.com" />
      <button class="email-btn" onclick="submitEmail()">Sonuçları Gör</button>
      <button class="skip-btn" onclick="skipEmail()">Atla, sonuçları göster</button>
    </div>
  </div>

  <footer>
    <div class="container footer-inner">
      <small>© <span id="y"></span> Typo</small>
      <div class="footer-links">
        <a href="../privacy.html">Gizlilik</a>
        <a href="../kvkk.html">KVKK</a>
        <a href="../terms.html">Koşullar</a>
      </div>
    </div>
  </footer>

  <script>
    // ========== IPC Test Data ==========
    const OCTANT_NAMES = {
      PA: 'Yönetici',
      BC: 'Stratejist',
      DE: 'Bağımsız',
      FG: 'Gözlemci',
      HI: 'Uyumlu',
      JK: 'Destekleyici',
      LM: 'Dost Canlısı',
      NO: 'Yıldız'
    };

    const OCTANT_DESCRIPTIONS = {
      PA: 'Liderlik özelliklerine sahip, yönlendirici ve kararlı bir iletişim tarzın var. İnsanları etkileme ve yönlendirme konusunda doğal bir yeteneğin bulunuyor.',
      BC: 'Mantıklı, analitik ve stratejik düşünen bir iletişim tarzın var. Duygulardan çok mantıkla hareket eder, hedeflerine odaklanırsın.',
      DE: 'Bağımsız, özerk ve kendi alanına değer veren bir iletişim tarzın var. Başkalarının sorunlarına mesafeli yaklaşır, kendi sınırlarını korursun.',
      FG: 'Gözlemci, düşünceli ve sakin bir iletişim tarzın var. Sosyal ortamlarda geri planda kalmayı tercih eder, özel hayatına önem verirsin.',
      HI: 'Uyumlu, dinleyici ve işbirlikçi bir iletişim tarzın var. Başkalarına alan bırakır, alçakgönüllü bir şekilde iletişim kurarsın.',
      JK: 'Destekleyici, şefkatli ve fedakar bir iletişim tarzın var. Başkalarının ihtiyaçlarını kendi ihtiyaçlarının önüne koyma eğilimindesin.',
      LM: 'Sıcak, samimi ve ilişki odaklı bir iletişim tarzın var. İnsanlarla derin bağlar kurar, onların iyiliğini önemsersin.',
      NO: 'Sosyal, enerjik ve ilgi çekici bir iletişim tarzın var. Kalabalıklarda rahat hisseder, yeni insanlarla tanışmaktan keyif alırsın.'
    };

    const IPC_QUESTIONS = [
      // PA: Assured-Dominant
      {
        id: 1, octant: 'PA',
        statement: 'Arkadaş grubunda bir konu hakkında sohbet ediliyor.',
        options: [
          { text: 'Sohbetin merkezinde olurum, herkesin beni dinlemesini isterim.', effect: { dom: 2, lov: 0 } },
          { text: 'Bazen öne çıkarım, bazen de geri planda kalırım.', effect: { dom: 0, lov: 0 } },
          { text: 'Kenarda kalır, başkalarının konuşmasına alan bırakırım.', effect: { dom: -2, lov: 0 } }
        ]
      },
      {
        id: 2, octant: 'PA',
        statement: 'Bir yemek masasında herkes sohbet ediyor.',
        options: [
          { text: 'Konuşmanın çoğunu ben yaparım, anlatacak çok şeyim vardır.', effect: { dom: 2, lov: 0 } },
          { text: 'Konuşma ve dinleme arasında denge kurarım.', effect: { dom: 0, lov: 0 } },
          { text: 'Daha çok dinlerim, ara sıra yorum yaparım.', effect: { dom: -2, lov: 0 } }
        ]
      },
      {
        id: 3, octant: 'PA',
        statement: 'Kalabalık bir ortamda bir şey anlatman gerekiyor.',
        options: [
          { text: 'Sesimi yükseltirim, herkesin duymasını sağlarım.', effect: { dom: 2, lov: 0 } },
          { text: 'Sakin bir şekilde, sadece yakınımdakilere anlatırım.', effect: { dom: -2, lov: 0 } }
        ]
      },
      // BC: Arrogant-Calculating
      {
        id: 4, octant: 'BC',
        statement: 'Biri hakkında dedikodu yapılıyor ve sen de oradasın.',
        options: [
          { text: 'O kişinin eksiklerini açıkça dile getiririm.', effect: { dom: 1, lov: -1 } },
          { text: 'Sessiz kalır, ne katılır ne karşı çıkarım.', effect: { dom: 0, lov: 0 } },
          { text: 'Konuyu değiştirmeye çalışır, olumsuz konuşmaktan kaçınırım.', effect: { dom: -1, lov: 1 } }
        ]
      },
      {
        id: 5, octant: 'BC',
        statement: 'Toplantıda biri seninle aynı fikirde olmadığın bir şey söyledi.',
        options: [
          { text: 'Hemen itiraz ederim, neden yanlış olduğunu söylerim.', effect: { dom: 1, lov: -1 } },
          { text: 'Kendi görüşümü sakin bir şekilde ifade ederim.', effect: { dom: 0, lov: 0 } },
          { text: 'Farklı görüşlere saygı duyar, tartışmaya girmem.', effect: { dom: -1, lov: 1 } }
        ]
      },
      {
        id: 6, octant: 'BC',
        statement: 'Birisi seni sinir eden bir şey yaptı.',
        options: [
          { text: 'Sert bir şekilde tepki veririm, ne düşündüğümü söylerim.', effect: { dom: 1, lov: -1 } },
          { text: 'Rahatsızlığımı nazikçe belirtirim.', effect: { dom: 0, lov: 0 } },
          { text: 'Sakin kalır, durumu yumuşatmaya çalışırım.', effect: { dom: -1, lov: 1 } }
        ]
      },
      // DE: Cold-Hearted
      {
        id: 7, octant: 'DE',
        statement: 'Bir arkadaşın sürekli aynı sorundan şikayet ediyor.',
        options: [
          { text: 'Kendi sorununu kendisi çözmeli derim, fazla dahil olmam.', effect: { dom: 0, lov: -2 } },
          { text: 'Dinlerim ama çözüm sunmam, kendi kararını vermesine izin veririm.', effect: { dom: 0, lov: 0 } },
          { text: 'Ona destek olmaya devam ederim, yanında olurum.', effect: { dom: 0, lov: 2 } }
        ]
      },
      {
        id: 8, octant: 'DE',
        statement: 'Birisi sana çok duygusal bir hikaye anlatıyor.',
        options: [
          { text: 'Mantıklı düşünürüm, kolayca etkilenmem.', effect: { dom: 0, lov: -2 } },
          { text: 'Hem empati kurar hem de mantıklı bakarım.', effect: { dom: 0, lov: 0 } },
          { text: 'Onun duygularını hisseder, derinden etkilenirim.', effect: { dom: 0, lov: 2 } }
        ]
      },
      {
        id: 9, octant: 'DE',
        statement: 'Tanıdığın biri zor bir dönemden geçiyor.',
        options: [
          { text: 'Kendi işlerime odaklanırım, herkesin hayatı kendine.', effect: { dom: 0, lov: -2 } },
          { text: 'Ona nasıl yardımcı olabileceğimi düşünürüm.', effect: { dom: 0, lov: 2 } }
        ]
      },
      // FG: Aloof-Introverted
      {
        id: 10, octant: 'FG',
        statement: 'Tanımadığın insanların olduğu bir etkinliktesin.',
        options: [
          { text: 'Sessiz kalır, konuşma başlatmaktan kaçınırım.', effect: { dom: -1, lov: -1 } },
          { text: 'Fırsat olursa konuşurum ama aramam.', effect: { dom: 0, lov: 0 } },
          { text: 'Yeni insanlarla tanışmaya çalışır, sohbet açarım.', effect: { dom: 1, lov: 1 } }
        ]
      },
      {
        id: 11, octant: 'FG',
        statement: 'Yeni tanıştığın biri sana özel sorular soruyor.',
        options: [
          { text: 'Kısa cevaplar veririm, özel hayatımı paylaşmam.', effect: { dom: -1, lov: -1 } },
          { text: 'Bazı şeyleri paylaşırım, bazılarını saklarım.', effect: { dom: 0, lov: 0 } },
          { text: 'Açık olurum, kendimden rahatça bahsederim.', effect: { dom: 1, lov: 1 } }
        ]
      },
      {
        id: 12, octant: 'FG',
        statement: 'Bir grup sohbetinde herkes konuşuyor.',
        options: [
          { text: 'Genellikle sessiz kalırım, söyleyecek fazla şeyim olmaz.', effect: { dom: -1, lov: -1 } },
          { text: 'Ben de aktif katılırım, fikirlerimi paylaşırım.', effect: { dom: 1, lov: 1 } }
        ]
      },
      // HI: Unassured-Submissive
      {
        id: 13, octant: 'HI',
        statement: 'Bir ortamda fikrini söylemen gerekiyor.',
        options: [
          { text: 'Sakin ve alçak sesle konuşurum.', effect: { dom: -2, lov: 0 } },
          { text: 'Normal bir ses tonuyla, duruma göre konuşurum.', effect: { dom: 0, lov: 0 } },
          { text: 'Kendinden emin, güçlü bir sesle konuşurum.', effect: { dom: 2, lov: 0 } }
        ]
      },
      {
        id: 14, octant: 'HI',
        statement: 'Biri seninle konuşurken aklına bir şey geldi.',
        options: [
          { text: 'Sözünü bitirmesini beklerim, sonra söylerim.', effect: { dom: -2, lov: 0 } },
          { text: 'Hemen araya girer, fikrimi söylerim.', effect: { dom: 2, lov: 0 } }
        ]
      },
      {
        id: 15, octant: 'HI',
        statement: 'Bir başarı elde ettin ve insanlar bunu öğrendi.',
        options: [
          { text: 'Mütevazı kalırım, çok bahsetmem.', effect: { dom: -2, lov: 0 } },
          { text: 'Sorulursa anlatırım, kendim öne çıkarmam.', effect: { dom: 0, lov: 0 } },
          { text: 'Gururla anlatırım, başarımı paylaşırım.', effect: { dom: 2, lov: 0 } }
        ]
      },
      // JK: Unassuming-Ingenuous
      {
        id: 16, octant: 'JK',
        statement: 'Biri seni rahatsız eden davranışlar sergiliyor.',
        options: [
          { text: 'Sabırlı davranır, hoşgörülü olurum.', effect: { dom: -1, lov: 1 } },
          { text: 'Duruma göre bazen tolere eder, bazen söylerim.', effect: { dom: 0, lov: 0 } },
          { text: 'Sınırlarımı net bir şekilde belirtirim.', effect: { dom: 1, lov: -1 } }
        ]
      },
      {
        id: 17, octant: 'JK',
        statement: 'Planlar beklenmedik şekilde değişti.',
        options: [
          { text: 'Akışına bırakırım, olayları olduğu gibi kabullenirim.', effect: { dom: -1, lov: 1 } },
          { text: 'Duruma adapte olurum ama tamamen pes etmem.', effect: { dom: 0, lov: 0 } },
          { text: 'Kontrolü geri almaya çalışırım, yeni plan yaparım.', effect: { dom: 1, lov: -1 } }
        ]
      },
      {
        id: 18, octant: 'JK',
        statement: 'Sen ve arkadaşın aynı şeyi istiyorsunuz ama sadece biriniz alabilir.',
        options: [
          { text: 'Arkadaşıma bırakırım, onun mutluluğu benim için önemli.', effect: { dom: -1, lov: 1 } },
          { text: 'Adil bir çözüm ararız, mesela yazı tura atarız.', effect: { dom: 0, lov: 0 } },
          { text: 'Ben almak isterim, kendi ihtiyacım öncelikli.', effect: { dom: 1, lov: -1 } }
        ]
      },
      {
        id: 19, octant: 'JK',
        statement: 'Bir hikaye anlatırken bazı detayları hatırlamıyorsun.',
        options: [
          { text: 'Sadece bildiğimi söylerim, uydurmam.', effect: { dom: -1, lov: 1 } },
          { text: 'Hikayeyi daha ilginç yapmak için detay eklerim.', effect: { dom: 1, lov: -1 } }
        ]
      },
      // LM: Warm-Agreeable
      {
        id: 20, octant: 'LM',
        statement: 'Yeni biriyle tanıştın ve sohbet ediyorsunuz.',
        options: [
          { text: 'Onun hayatını, hikayesini merak eder, sorular sorarım.', effect: { dom: 0, lov: 2 } },
          { text: 'Yüzeysel sohbet ederim, çok derinleşmem.', effect: { dom: 0, lov: -2 } }
        ]
      },
      {
        id: 21, octant: 'LM',
        statement: 'Bir arkadaşın stresli ve endişeli görünüyor.',
        options: [
          { text: 'Onu rahatlatmaya, moral vermeye çalışırım.', effect: { dom: 0, lov: 2 } },
          { text: 'Fark ederim ama isterse konuşur diye beklerim.', effect: { dom: 0, lov: 0 } },
          { text: 'Çok kurcalamak istemem, gidip sormam.', effect: { dom: 0, lov: -2 } }
        ]
      },
      {
        id: 22, octant: 'LM',
        statement: 'Bir süredir görmediğin biriyle karşılaştın.',
        options: [
          { text: 'Nasıl olduğunu, hayatının nasıl gittiğini sorarım.', effect: { dom: 0, lov: 2 } },
          { text: 'Selam verip geçerim, çok soru sormam.', effect: { dom: 0, lov: -2 } }
        ]
      },
      // NO: Gregarious-Extraverted
      {
        id: 23, octant: 'NO',
        statement: 'Kalabalık bir ortama girdin.',
        options: [
          { text: 'Enerjim artar, insanların arasında olmak hoşuma gider.', effect: { dom: 1, lov: 1 } },
          { text: 'Ne rahatsız olurum ne de özellikle mutlu, normal karşılarım.', effect: { dom: 0, lov: 0 } },
          { text: 'Bunalırım, sakin bir köşe ararım.', effect: { dom: -1, lov: -1 } }
        ]
      },
      {
        id: 24, octant: 'NO',
        statement: 'Ofiste veya sınıftasın, yabancı biri var.',
        options: [
          { text: 'Sohbet başlatırım, sessizliği bozmak bana kolay gelir.', effect: { dom: 1, lov: 1 } },
          { text: 'Göz teması kurar, gülümserim ama konuşma başlatmam.', effect: { dom: 0, lov: 0 } },
          { text: 'Sessiz kalırım, telefonuma bakarım.', effect: { dom: -1, lov: -1 } }
        ]
      },
      {
        id: 25, octant: 'NO',
        statement: 'Bir partidesin ve birçok insan var.',
        options: [
          { text: 'Farklı gruplarla sohbet eder, herkesle konuşurum.', effect: { dom: 1, lov: 1 } },
          { text: 'Birkaç yeni kişiyle tanışırım ama herkesle değil.', effect: { dom: 0, lov: 0 } },
          { text: 'Tanıdığım birkaç kişiyle vakit geçiririm.', effect: { dom: -1, lov: -1 } }
        ]
      },
      {
        id: 26, octant: 'NO',
        statement: 'Hafta sonu için iki etkinlik seçeneği var.',
        options: [
          { text: 'Kalabalık partiyi seçerim, büyük etkinlikler eğlenceli.', effect: { dom: 1, lov: 1 } },
          { text: 'O anki ruh halime göre karar veririm.', effect: { dom: 0, lov: 0 } },
          { text: 'Küçük, samimi buluşmayı tercih ederim.', effect: { dom: -1, lov: -1 } }
        ]
      }
    ];

    // ========== Test State ==========
    let currentStep = 0;
    let scores = { dom: 0, lov: 0 };
    let answeredQuestions = new Set();
    let questionAnswers = {}; // Store which option was selected for each question
    let userEmail = '';
    let isAnimating = false;

    // ========== DOM Elements ==========
    const startScreen = document.getElementById('startScreen');
    const testArea = document.getElementById('testArea');
    const questionArea = document.getElementById('questionArea');
    const resultsContainer = document.getElementById('resultsContainer');
    const emailModal = document.getElementById('emailModal');
    const progressFill = document.getElementById('progressFill');
    const currentQSpan = document.getElementById('currentQ');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    // ========== Core Functions ==========
    function startTest() {
      startScreen.style.display = 'none';
      testArea.classList.add('active');
      renderQuestion();
    }

    function renderQuestion() {
      const question = IPC_QUESTIONS[currentStep];
      if (!question) return;

      // Update progress
      const progress = ((currentStep + 1) / IPC_QUESTIONS.length) * 100;
      progressFill.style.width = progress + '%';
      currentQSpan.textContent = currentStep + 1;
      document.getElementById('totalQ').textContent = IPC_QUESTIONS.length;

      // Update nav buttons
      prevBtn.disabled = currentStep === 0;
      nextBtn.style.visibility = answeredQuestions.has(currentStep) && currentStep < IPC_QUESTIONS.length - 1 ? 'visible' : 'hidden';

      // Build question HTML
      let optionsHTML = '';
      question.options.forEach((option, index) => {
        optionsHTML += `
          <div class="choice-card" onclick="handleAnswer(${index})" tabindex="0" role="button">
            <span class="choice-text">${option.text}</span>
            <div class="choice-circle"></div>
          </div>
        `;
      });

      questionArea.innerHTML = `
        <div class="question-slide">
          <h2 class="scenario-text">${question.statement}</h2>
          <div class="choices-container">
            ${optionsHTML}
          </div>
        </div>
      `;
    }

    function handleAnswer(optionIndex) {
      if (isAnimating) return;
      
      const question = IPC_QUESTIONS[currentStep];
      const option = question.options[optionIndex];
      
      // If this question was already answered, subtract the old score first
      if (questionAnswers[currentStep] !== undefined) {
        const oldOption = question.options[questionAnswers[currentStep]];
        scores.dom -= oldOption.effect.dom;
        scores.lov -= oldOption.effect.lov;
      }
      
      // Mark as answered and store the selected option
      answeredQuestions.add(currentStep);
      questionAnswers[currentStep] = optionIndex;
      
      // Update scores
      scores.dom += option.effect.dom;
      scores.lov += option.effect.lov;

      // Move to next question or finish
      if (currentStep < IPC_QUESTIONS.length - 1) {
        animateToNext();
      } else {
        finishTest();
      }
    }

    function animateToNext() {
      if (isAnimating) return;
      isAnimating = true;

      const slide = questionArea.querySelector('.question-slide');
      if (slide) slide.classList.add('slide-out-left');

      setTimeout(() => {
        currentStep++;
        renderQuestion();
        isAnimating = false;
      }, 250);
    }

    function animateToPrevious() {
      if (isAnimating) return;
      isAnimating = true;

      const slide = questionArea.querySelector('.question-slide');
      if (slide) slide.classList.add('slide-out-right');

      setTimeout(() => {
        currentStep--;
        renderQuestion();
        isAnimating = false;
      }, 250);
    }

    function goToPrevious() {
      if (currentStep > 0 && !isAnimating) {
        animateToPrevious();
      }
    }

    function goToNext() {
      if (currentStep < IPC_QUESTIONS.length - 1 && answeredQuestions.has(currentStep) && !isAnimating) {
        animateToNext();
      }
    }

    function finishTest() {
      // Show email modal
      testArea.classList.remove('active');
      emailModal.classList.add('active');
    }

    function submitEmail() {
      const emailInput = document.getElementById('emailInput');
      userEmail = emailInput.value.trim();
      
      // Optionally save email to localStorage or send to server
      if (userEmail) {
        localStorage.setItem('typo_ipc_email', userEmail);
        localStorage.setItem('typo_ipc_scores', JSON.stringify(scores));
      }
      
      showResults();
    }

    function skipEmail() {
      showResults();
    }

    function showResults() {
      emailModal.classList.remove('active');
      resultsContainer.classList.add('active');

      // Calculate octant type
      const octantType = calculateOctant(scores.dom, scores.lov);
      
      // Update result icon
      const resultIcon = document.getElementById('resultIcon');
      resultIcon.innerHTML = `<img src="../assets/IPC_icons/${octantType}.png" alt="${OCTANT_NAMES[octantType]}" />`;

      // Update title and description
      document.getElementById('resultTitle').textContent = OCTANT_NAMES[octantType];
      document.getElementById('resultDescription').textContent = OCTANT_DESCRIPTIONS[octantType];

      // Calculate percentages for bars
      const maxPossible = 26;
      const domPercent = Math.round(((scores.dom + maxPossible) / (2 * maxPossible)) * 100);
      const lovPercent = Math.round(((scores.lov + maxPossible) / (2 * maxPossible)) * 100);

      // Animate score bars
      setTimeout(() => {
        document.getElementById('domBar').style.width = domPercent + '%';
        document.getElementById('lovBar').style.width = lovPercent + '%';
      }, 100);

      document.getElementById('domValue').textContent = scores.dom > 0 ? '+' + scores.dom : scores.dom;
      document.getElementById('lovValue').textContent = scores.lov > 0 ? '+' + scores.lov : scores.lov;

      // Save to localStorage
      localStorage.setItem('typo_ipc_result', JSON.stringify({
        octant: octantType,
        scores: scores,
        timestamp: new Date().toISOString()
      }));
    }

    // IPC Circle octant angles (in degrees, measured counter-clockwise from positive X axis / lov axis)
    // Each octant is centered at these angles, spanning 45° (±22.5° from center)
    const OCTANT_ANGLES = {
      LM: 0,    // Warm-Agreeable: 0° (positive lov, neutral dom)
      NO: 45,   // Gregarious-Extraverted: 45° (positive lov, positive dom)
      PA: 90,   // Assured-Dominant: 90° (positive dom, neutral lov)
      BC: 135,  // Arrogant-Calculating: 135° (positive dom, negative lov)
      DE: 180,  // Cold-Hearted: 180° (negative lov, neutral dom)
      FG: 225,  // Aloof-Introverted: 225° (negative lov, negative dom)
      HI: 270,  // Unassured-Submissive: 270° (negative dom, neutral lov)
      JK: 315,  // Unassuming-Ingenuous: 315° (negative dom, positive lov)
    };

    // Calculate octant type from dom and lov scores using vector angle
    // IPC Circle: X-axis = Love/Warmth (lov), Y-axis = Dominance (dom)
    function calculateOctant(dom, lov) {
      // If both scores are 0, default to LM (warm-agreeable)
      if (dom === 0 && lov === 0) return 'LM';
      
      // Calculate angle in degrees from the positive X-axis (lov axis)
      // atan2(y, x) gives angle where x=lov, y=dom
      let angle = Math.atan2(dom, lov) * (180 / Math.PI);
      
      // Normalize angle to 0-360 range
      if (angle < 0) angle += 360;
      
      // Find the closest octant by comparing angular distance
      let closestOctant = 'LM';
      let minDistance = 360;
      
      for (const [octant, octantAngle] of Object.entries(OCTANT_ANGLES)) {
        // Calculate angular distance (accounting for wrap-around at 360°)
        let distance = Math.abs(angle - octantAngle);
        if (distance > 180) distance = 360 - distance;
        
        if (distance < minDistance) {
          minDistance = distance;
          closestOctant = octant;
        }
      }
      
      return closestOctant;
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') goToPrevious();
      if (e.key === 'ArrowRight') goToNext();
      if (e.key >= '1' && e.key <= '3') {
        const index = parseInt(e.key) - 1;
        const question = IPC_QUESTIONS[currentStep];
        if (question && question.options[index]) {
          handleAnswer(index);
        }
      }
    });

    // Set year in footer
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
