<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>MBTI Testi - Typo</title>
  <meta name="description" content="Typo MBTI Kişilik Testi - 16 kişilik tipinden hangisi olduğunu keşfet." />
  <meta property="og:site_name" content="Typo" />
  <link rel="icon" href="../assets/app_icon.png" />
  <link rel="preload" href="../assets/fonts/lora/Lora-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="../assets/fonts/montserrat/Montserrat-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="stylesheet" href="../site.css" />
  <style>
    /* MBTI Test Specific Styles */
    .test-container {
      display: flex;
      flex-direction: column;
    }

    /* Progress Bar */
    .progress-wrapper {
      padding: 16px 0;
      position: sticky;
      top: 60px;
      background: var(--bg);
      z-index: 5;
    }
    .progress-track {
      height: 6px;
      background: rgba(181, 106, 85, 0.2);
      border-radius: 3px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 3px;
      transition: width 0.4s ease;
      width: 0%;
    }
    .progress-text {
      text-align: center;
      font-size: 14px;
      color: var(--fg);
      margin-top: 8px;
      opacity: 0.7;
    }

    /* Question Area */
    .question-area {
      padding: 24px 0 16px;
      position: relative;
      overflow: hidden;
    }

    .question-slide {
      animation: slideIn 0.3s ease forwards;
    }
    .question-slide.slide-out-left {
      animation: slideOutLeft 0.25s ease forwards;
    }
    .question-slide.slide-out-right {
      animation: slideOutRight 0.25s ease forwards;
    }
    .question-slide.slide-in-left {
      animation: slideInLeft 0.3s ease forwards;
    }

    @keyframes slideIn {
      from { transform: translateX(60px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutLeft {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(-60px); opacity: 0; }
    }
    @keyframes slideOutRight {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(60px); opacity: 0; }
    }
    @keyframes slideInLeft {
      from { transform: translateX(-60px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Question Boxes */
    .choices-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Desktop: horizontal layout */
    @media (min-width: 768px) {
      .choices-container {
        flex-direction: row;
        gap: 24px;
        align-items: stretch;
      }
      .choices-container .question-box {
        flex: 1;
      }
      .yada-container {
        display: flex;
        align-items: center;
        padding: 0 8px;
      }
    }

    .question-box {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      min-height: 100px;
    }
    .question-box:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    .question-box:active {
      transform: translateY(0);
    }
    .question-box.selected-a {
      background: #fffaf8;
      border-color: var(--primary);
      border-width: 2px;
    }
    .question-box.selected-b {
      background: #f8fffa;
      border-color: var(--secondary);
      border-width: 2px;
    }

    .badge {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 13px;
      font-weight: bold;
    }
    .badge-a { background: var(--primary); }
    .badge-b { background: var(--secondary); }

    .question-text {
      font-family: 'Lora', serif;
      font-size: 14px;
      color: var(--fg);
      line-height: 1.6;
      margin-top: 8px;
    }
    .question-text.selected {
      font-weight: 600;
    }

    .example-text {
      margin-top: 12px;
    }
    .example-label {
      font-family: 'Montserrat', sans-serif;
      font-size: 13px;
      font-weight: 600;
      color: #e6a23c;
    }
    .example-content {
      font-family: 'Lora', serif;
      font-size: 13px;
      color: var(--fg);
      opacity: 0.7;
      line-height: 1.5;
    }

    .yada-container {
      text-align: center;
      margin: 4px 0;
    }
    .yada-text {
      font-family: 'Lora', serif;
      font-size: 18px;
      font-weight: 600;
      color: var(--fg);
      opacity: 0.5;
    }

    /* Bottom Container - Inline after scenarios */
    .bottom-container {
      padding: 16px 0 48px;
    }

    /* Likert Scale */
    .likert-container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 25px;
    }
    .likert-scale {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }
    .likert-btn {
      border-radius: 50%;
      border: 2px solid var(--border);
      background: var(--card);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .likert-btn.size-lg { width: clamp(40px, 10vw, 48px); height: clamp(40px, 10vw, 48px); }
    .likert-btn.size-md { width: clamp(36px, 8vw, 40px); height: clamp(36px, 8vw, 40px); }
    .likert-btn.size-sm { width: clamp(32px, 7vw, 36px); height: clamp(32px, 7vw, 36px); }
    .likert-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .likert-btn.selected {
      border-width: 3px;
    }
    .likert-btn.selected-1, .likert-btn.selected-2 {
      border-color: var(--primary);
      background: var(--primary);
    }
    .likert-btn.selected-3 {
      border-color: var(--muted);
      background: var(--muted);
    }
    .likert-btn.selected-4, .likert-btn.selected-5 {
      border-color: var(--secondary);
      background: var(--secondary);
    }
    .likert-labels {
      display: flex;
      justify-content: space-between;
      padding: 0 4px;
    }
    .likert-label {
      font-size: 11px;
      font-weight: 600;
    }
    .likert-label-a { color: var(--primary); }
    .likert-label-neutral { color: var(--fg); opacity: 0.5; }
    .likert-label-b { color: var(--secondary); }

    /* Navigation */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      max-width: 1100px;
      margin: 16px auto 0;
      padding: 0 25px;
    }

    .nav-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--card);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    .nav-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }
    .nav-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .nav-btn svg {
      width: 24px;
      height: 24px;
      stroke: var(--fg);
      stroke-width: 2;
      fill: none;
    }

    /* Email Collection Modal */
    .email-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }
    .email-modal.active {
      display: flex;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .email-card {
      background: var(--card);
      border-radius: 24px;
      padding: 40px;
      max-width: 480px;
      width: 100%;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .email-card h2 {
      font-family: 'Lora', serif;
      font-size: 24px;
      margin: 0 0 12px;
    }
    .email-card p {
      color: var(--fg);
      opacity: 0.8;
      margin: 0 0 24px;
      font-size: 15px;
    }

    .email-input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 16px;
      font-family: inherit;
      margin-bottom: 16px;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }
    .email-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .email-btn {
      width: 100%;
      padding: 14px 24px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 999px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 12px;
    }
    .email-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .skip-btn {
      background: none;
      border: none;
      color: var(--fg);
      opacity: 0.6;
      cursor: pointer;
      font-size: 14px;
      padding: 8px;
    }
    .skip-btn:hover {
      opacity: 1;
      text-decoration: underline;
    }

    /* Results Section */
    .results-container {
      display: none;
      text-align: center;
      padding: 40px 0;
      animation: fadeIn 0.5s ease;
    }
    .results-container.active {
      display: block;
    }

    .result-icon {
      font-size: 60px;
      margin-bottom: 16px;
    }

    .result-subtitle {
      font-size: 14px;
      color: var(--primary);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin: 0 0 8px;
    }

    .result-title {
      font-family: 'Lora', serif;
      font-size: clamp(36px, 6vw, 48px);
      color: var(--fg);
      margin: 0 0 32px;
      letter-spacing: 4px;
    }

    .result-scores {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 500px;
      margin: 0 auto 32px;
    }

    .score-item {
      display: flex;
      align-items: center;
      gap: 12px;
      text-align: left;
    }
    .score-label {
      font-size: 13px;
      color: var(--fg);
      min-width: 200px;
    }
    .score-bar-container {
      flex: 1;
      height: 8px;
      background: rgba(181, 106, 85, 0.2);
      border-radius: 4px;
      overflow: hidden;
    }
    .score-bar {
      height: 100%;
      background: var(--primary);
      border-radius: 4px;
      transition: width 1s ease;
    }
    .score-value {
      font-size: 14px;
      font-weight: 700;
      color: var(--fg);
      min-width: 40px;
      text-align: right;
    }

    .result-description {
      font-size: 16px;
      color: var(--fg);
      line-height: 1.7;
      max-width: 600px;
      margin: 0 auto 40px;
      padding: 24px;
      background: var(--card);
      border-radius: 16px;
      border: 1px solid var(--border);
    }

    .result-cta {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 999px;
      padding: 14px 28px;
      font-weight: 700;
      text-decoration: none;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .result-cta:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    /* Start Screen */
    .start-screen {
      text-align: center;
      padding: 60px 20px;
    }
    .start-screen h1 {
      font-family: 'Lora', serif;
      font-size: clamp(28px, 5vw, 40px);
      margin: 0 0 16px;
    }
    .start-screen p {
      font-size: 17px;
      color: var(--fg);
      opacity: 0.8;
      max-width: 500px;
      margin: 0 auto 32px;
    }
    .start-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 999px;
      padding: 16px 32px;
      font-weight: 700;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(181, 106, 85, 0.3);
    }

    .test-info {
      display: flex;
      gap: 24px;
      justify-content: center;
      margin-top: 32px;
      flex-wrap: wrap;
    }
    .test-info-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--fg);
      opacity: 0.7;
    }
    .test-info-item svg {
      width: 20px;
      height: 20px;
      stroke: var(--primary);
    }

    /* Hide test when showing start/results */
    .test-area {
      display: none;
    }
    .test-area.active {
      display: flex;
      flex-direction: column;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .question-box {
        padding: 16px;
      }
      .question-text {
        font-size: 15px;
      }
      .example-content {
        font-size: 14px;
      }
      .likert-container {
        padding: 0 8px;
      }
      .likert-label {
        font-size: 13px;
      }
      .nav-btn {
        width: 48px;
        height: 48px;
      }
      .email-card {
        padding: 28px 20px;
      }
      .skip-btn {
        padding: 12px 16px;
        min-height: 44px;
      }
      .score-label {
        min-width: 100px;
        font-size: 13px;
      }
      .score-item {
        gap: 8px;
      }
      .start-screen {
        padding: 40px 16px;
      }
      .bottom-container {
        padding-bottom: max(32px, env(safe-area-inset-bottom));
      }
    }

    @media (max-width: 380px) {
      .score-item {
        flex-wrap: wrap;
      }
      .score-label {
        width: 100%;
        min-width: unset;
        margin-bottom: 4px;
      }
      .question-box {
        padding: 14px;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .question-slide {
        animation: none;
      }
      .question-slide.slide-out-left,
      .question-slide.slide-out-right {
        animation: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="../index.html">
        <img class="brand-logo" alt="Typo" src="../assets/text_logo.png" />
      </a>
      <nav class="nav-links">
        <a href="../index.html">Ana Sayfa</a>
        <a href="../privacy.html">Gizlilik</a>
        <a href="../terms.html">Koşullar</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
      <h1>MBTI Kişilik Testi</h1>
      <p>Bu test, bilişsel işlevlerini ve kişilik tipini keşfetmene yardımcı olacak. Her soruda sana en yakın olan ifadeyi seç.</p>
      <button class="start-btn" onclick="startTest()">
        Teste Başla
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </button>
      <div class="test-info">
        <div class="test-info-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <span>~10 dakika</span>
        </div>
        <div class="test-info-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg>
          <span>25 soru</span>
        </div>
        <div class="test-info-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
          <span>Anonim</span>
        </div>
      </div>
    </div>

    <!-- Test Area -->
    <div class="test-container test-area" id="testArea">
      <!-- Progress Bar -->
      <div class="progress-wrapper">
        <div class="progress-track">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text"><span id="currentQ">1</span> / <span id="totalQ">25</span></div>
      </div>

      <!-- Question Area -->
      <div class="question-area" id="questionArea">
        <!-- Questions will be dynamically inserted here -->
      </div>

      <!-- Bottom Container (Inline) -->
      <div class="bottom-container" id="bottomContainer" style="display: none;">
        <!-- Likert Scale -->
        <div class="likert-container">
          <div class="likert-scale" id="likertScale">
            <!-- Likert buttons will be inserted here -->
          </div>
          <div class="likert-labels">
            <span class="likert-label likert-label-a">Kesinlikle A</span>
            <span class="likert-label likert-label-neutral">Nötr</span>
            <span class="likert-label likert-label-b">Kesinlikle B</span>
          </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="nav-buttons">
          <button class="nav-btn" id="prevBtn" onclick="goToPrevious()" disabled>
            <svg viewBox="0 0 24 24">
              <path d="M15 18l-6-6 6-6"/>
            </svg>
          </button>
          <button class="nav-btn" id="nextBtn" onclick="goToNext()" style="visibility: hidden;">
            <svg viewBox="0 0 24 24">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Results Container -->
    <div class="results-container" id="resultsContainer">
      <div class="result-icon">✨</div>
      <p class="result-subtitle">MBTI Sonucun</p>
      <h1 class="result-title" id="resultTitle">—</h1>
      <div class="result-scores" id="resultScores">
        <!-- Scores will be inserted here -->
      </div>
      <p class="result-description" id="resultDescription">Test tamamlandı. Sonuçlarınız kaydedildi.</p>
      <a href="../index.html" class="result-cta">
        Typo'yu Keşfet
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </main>

  <!-- Email Modal -->
  <div class="email-modal" id="emailModal">
    <div class="email-card">
      <h2>Sonuçlarını Kaydet</h2>
      <p>E-posta adresini girerek sonuçlarını kaydedebilirsin. Typo uygulamasına aynı e-posta ile giriş yaparsan, sonuçların otomatik olarak profiline eklenecek.</p>
      <input type="email" class="email-input" id="emailInput" placeholder="ornek@email.com" />
      <button class="email-btn" onclick="submitEmail()">Sonuçları Gör</button>
      <button class="skip-btn" onclick="skipEmail()">Atla, sonuçları göster</button>
    </div>
  </div>

  <footer>
    <div class="container footer-inner">
      <small>© <span id="y"></span> Typo</small>
      <div class="footer-links">
        <a href="../privacy.html">Gizlilik</a>
        <a href="../kvkk.html">KVKK</a>
        <a href="../terms.html">Koşullar</a>
      </div>
    </div>
  </footer>

  <script>
    // ========== MBTI Test Data ==========
    const MBTI_PAIRS = [
      // Te vs Ti - Extraverted Thinking vs Introverted Thinking
      { 
        id: 1, 
        left: { text: "Bir sistemin nasıl çalıştığından çok, ne kadar verimli sonuç verdiğiyle ilgilenirim.", example: "Bir yöntem işimi hızlıca çözüyorsa, arkasındaki teorik mantığı öğrenmekle vakit kaybetmem.", function: 'Te' }, 
        right: { text: "Bir sistemin sadece sonuç vermesi yetmez, mantıksal altyapısını da kavramalıyım.", example: "Bir yöntem işe yarasa bile, 'neden' ve 'nasıl' çalıştığını anlamadan o yöntemi kullanmak içime sinmez.", function: 'Ti' } 
      },
      { 
        id: 2, 
        left: { text: "Karar verirken dış dünyadaki kanıtlara ve standartlara güvenirim.", example: "Bir ürün alırken teknik özelliklerden çok, uzman puanlarına ve kullanıcı istatistiklerine bakarım.", function: 'Te' }, 
        right: { text: "Karar verirken kendi mantıksal analizime güvenirim.", example: "Herkes bir ürünü övse bile, tasarımında mantıksız bir hata görürsem o ürünü almam.", function: 'Ti' } 
      },
      { 
        id: 3, 
        left: { text: "Yeni bir cihaz aldığımda kılavuzu okumak yerine hemen tuşlara basıp kurcalayarak öğrenirim.", example: "'Bunu çalıştırmanın en kısa yolu ne?' diye bakarım, teorisiyle ilgilenmem.", function: 'Te' }, 
        right: { text: "Yeni bir cihaz aldığımda önce prensibini anlamaya çalışırım.", example: "'Bu özellik neden buraya konmuş, arkasındaki mantık ne?' diye düşünmeden rahat edemem.", function: 'Ti' } 
      },
      { 
        id: 4, 
        left: { text: "Kurallar ve prosedürler düzeni sağlamak için vardır, onlara uyarım.", example: "Bir kural saçma bile olsa, işler yürüsün diye ona itiraz etmeden uygularım.", function: 'Te' }, 
        right: { text: "Kurallar mantıklı olduğu sürece geçerlidir.", example: "Bir kural bana mantıksız gelirse, onu görmezden gelir veya kendi mantığıma uyan yeni bir yöntem geliştiririm.", function: 'Ti' } 
      },
      { 
        id: 5, 
        left: { text: "Kaynakları yönetmek ve insanları organize etmekte doğal bir yeteneğim var.", example: "Bir grup projesinde kimin ne yapacağını hemen belirler ve süreci yönetirim.", function: 'Te' }, 
        right: { text: "Bilgiyi analiz etmek ve tutarsızlıkları bulmakta doğal bir yeteneğim var.", example: "Bir rapordaki veya teorideki mantık hatasını şıp diye fark ederim.", function: 'Ti' } 
      },

      // Fe vs Fi - Extraverted Feeling vs Introverted Feeling
      { 
        id: 6, 
        left: { text: "Kararlarımın başkalarını nasıl etkileyeceği benim için önceliklidir.", example: "Bir seçim yaparken 'Bu gruptaki huzuru bozar mı?' diye endişelenirim.", function: 'Fe' }, 
        right: { text: "Kararlarımın kendi değerlerimle örtüşmesi benim için önceliklidir.", example: "Bir seçim yaparken 'Bu benim vicdanıma ve kimliğime uygun mu?' diye sorarım.", function: 'Fi' } 
      },
      { 
        id: 7, 
        left: { text: "Ortamın duygusal atmosferini sünger gibi emerim.", example: "Yanımdaki kişi gerginse, sebebini bilmesem bile ben de anında gerilirim.", function: 'Fe' }, 
        right: { text: "Duygularım dışarıdan bağımsız ve derinliklidir.", example: "Ortam çok neşeli olsa bile, içimde hissettiğim hüzün veya ciddiyeti koruyabilirim.", function: 'Fi' } 
      },
      { 
        id: 8, 
        left: { text: "İletişimde nezaket ve sosyal uyum, dürüstlükten (eğer kırıcıysa) önce gelebilir.", example: "Birinin kıyafetini beğenmesem bile, onu mutlu etmek için 'Güzel olmuş' diyebilirim.", function: 'Fe' }, 
        right: { text: "İletişimde samimiyet ve otantiklik, sosyal nezaketten önce gelir.", example: "Yapmacık bir iltifat etmektense sessiz kalmayı veya nazikçe gerçeği söylemeyi tercih ederim.", function: 'Fi' } 
      },
      { 
        id: 9, 
        left: { text: "Duygularımı dışa vurarak ve paylaşarak işlerim.", example: "Üzüldüğümde veya sevindiğimde bunu hemen birine anlatma veya gösterme ihtiyacı duyarım.", function: 'Fe' }, 
        right: { text: "Duygularımı kendi içimde yaşayarak işlerim.", example: "En yoğun duygularımı dışarıya pek yansıtmam, insanlar beni 'soğuk' veya 'duygusuz' sanabilir ama içimde fırtınalar kopar.", function: 'Fi' } 
      },
      { 
        id: 10, 
        left: { text: "Başkalarının neye ihtiyacı olduğunu onlar söylemeden sezerim.", example: "Bir misafirin üşüdüğünü veya sıkıldığını hemen fark eder, ortamı ona göre ayarlarım.", function: 'Fe' }, 
        right: { text: "Kendi hislerimi çok iyi tanırım ve başkalarını da bu pencereden anlarım.", example: "'Ben bu durumda olsam ne hissederdim?' diyerek empati kurarım.", function: 'Fi' } 
      },

      // Se vs Si - Extraverted Sensing vs Introverted Sensing
      { 
        id: 11, 
        left: { text: "Şu anı tüm duyularımla, olduğu gibi yaşarım.", example: "Bir manzaraya bakarken detayları, renkleri ve sesleri o anki canlılığıyla algılarım.", function: 'Se' }, 
        right: { text: "Şu anı geçmiş deneyimlerimle kıyaslayarak yaşarım.", example: "Bir manzaraya bakarken bana hatırlattığı eski bir anıyı veya hissi düşünürüm.", function: 'Si' } 
      },
      { 
        id: 12, 
        left: { text: "Fiziksel dünyada hızlı tepki veririm ve risk almaktan çekinmem.", example: "Spontane gelişen olaylarda paniklemem, aksine canlanırım ve hemen harekete geçerim.", function: 'Se' }, 
        right: { text: "Fiziksel dünyada temkinliyimdir ve bildiğim yolları tercih ederim.", example: "Yeni bir maceraya atılmadan önce, geçmişte benzer durumlarda ne olduğunu gözden geçiririm.", function: 'Si' } 
      },
      { 
        id: 13, 
        left: { text: "Estetik algım 'etki' ve 'görsellik' üzerinedir.", example: "Modayı, trendleri veya göze çarpan, dikkat çekici tasarımları takip etmeyi severim.", function: 'Se' }, 
        right: { text: "Estetik algım 'konfor' ve 'aşinalık' üzerinedir.", example: "Bana kendimi iyi hissettiren, klasikleşmiş veya kişisel anlamı olan nesneleri severim.", function: 'Si' } 
      },
      { 
        id: 14, 
        left: { text: "Yeni deneyimler peşinde koşarım, sıkılmak en büyük düşmanımdır.", example: "Sürekli aynı yemeği yemek veya aynı aktiviteyi yapmak beni bunaltır.", function: 'Se' }, 
        right: { text: "Rutinler ve gelenekler bana güven verir.", example: "Her sabah aynı kahveyi içmek veya bayramları aynı şekilde kutlamak benim için huzur kaynağıdır.", function: 'Si' } 
      },
      { 
        id: 15, 
        left: { text: "Gerçekleri 'objektif' olarak görürüm.", example: "'Masa burada, sandalye şurada' gibi somut verilere odaklanırım, yorum katmam.", function: 'Se' }, 
        right: { text: "Gerçekleri 'subjektif' izlenimlerle kaydederim.", example: "Olayın kendisinden çok, o olayın bende bıraktığı fiziksel ve duygusal izi hatırlarım.", function: 'Si' } 
      },

      // Ne vs Ni - Extraverted Intuition vs Introverted Intuition
      { 
        id: 16, 
        left: { text: "Bir fikirden yola çıkıp onlarca farklı olasılık üretirim.", example: "'Bu proje şöyle de olabilir, böyle de olabilir, hatta bambaşka bir şeye de dönüşebilir!' derim.", function: 'Ne' }, 
        right: { text: "Karmaşık verileri birleştirip tek bir olası sonuca odaklanırım.", example: "'Tüm bu işaretler tek bir şeyi gösteriyor, olay kesinlikle şuraya varacak' derim.", function: 'Ni' } 
      },
      { 
        id: 17, 
        left: { text: "Zihnim dağınık ve bağlantısaldır; konudan konuya atlarım.", example: "Sohbet ederken bir kelime bana başka bir şeyi hatırlatır ve konu aniden değişir.", function: 'Ne' }, 
        right: { text: "Zihnim odaklı ve derinlemesine işler; özü ararım.", example: "Konu ne kadar dağılırsa dağılsın, ben hep 'Peki bunun ana fikri, asıl anlamı ne?' diye düşünürüm.", function: 'Ni' } 
      },
      { 
        id: 18, 
        left: { text: "Geleceği 'açık uçlu' bir macera olarak görürüm.", example: "Planlarımın esnek olması ve her an değişebilmesi beni heyecanlandırır.", function: 'Ne' }, 
        right: { text: "Geleceği 'gerçekleşmesi muhtemel bir vizyon' olarak görürüm.", example: "Kafamda geleceğe dair net bir resim vardır ve bugünkü eylemlerimi ona göre şekillendiririm.", function: 'Ni' } 
      },
      { 
        id: 19, 
        left: { text: "Bir konuyu anlatırken sürekli yan konulara saparım.", example: "Futboldan bahsederken konu bir anda stadyum mimarisine, oradan da Roma tarihine gelebilir.", function: 'Ne' }, 
        right: { text: "Bir konuyu anlatırken gereksiz detayları atıp ana fikre odaklanırım.", example: "Lafı dolandırmam, 'Sonuç olarak olay şuraya bağlanıyor' diyerek özeti veririm.", function: 'Ni' } 
      },
      { 
        id: 20, 
        left: { text: "Beyin fırtınası yaparken başkalarının fikirleri beni ateşler.", example: "'Ya şöyle yaparsak?' denildiğinde hemen üzerine beş fikir daha eklerim.", function: 'Ne' }, 
        right: { text: "İçgörülerim genellikle yalnızken ve aniden gelir ('Aha!' anı).", example: "Bir problem üzerine düşünmeyi bıraktığımda, duşta veya yürürken çözüm aniden zihnimde belirir.", function: 'Ni' } 
      },

      // E vs I - Extraversion vs Introversion
      { 
        id: 21, 
        left: { text: "Hiç tanımadığım insanlarla dolu bir ortamda sohbet başlatmakta zorlanmam.", example: "Bir bekleme salonunda veya etkinlikte yanımda oturan kişiye rahatça soru sorabilirim.", function: 'E' }, 
        right: { text: "Tanımadığım insanlarla konuşurken tutukluk yaşarım ve ne diyeceğimi bilemem.", example: "Karşı taraf konuşmadıkça sessiz kalmayı ve göz teması kurmamayı tercih ederim.", function: 'I' } 
      },
      { 
        id: 22, 
        left: { text: "İlgi odağı olduğum durumlarda rahat hissederim, paniklemem.", example: "Bir kalabalığa sunum yaparken veya bir hikaye anlatırken gözlerin üzerimde olması beni germez.", function: 'E' }, 
        right: { text: "Gözler üzerime çevrildiğinde gerilirim ve bir an önce bitmesini isterim.", example: "Topluluk önünde konuşurken yüzüm kızarır veya sesim titrer, görünmez olmak isterim.", function: 'I' } 
      },
      { 
        id: 23, 
        left: { text: "Bir grupta sözümü dinletmek ve otorite kurmak benim için kolaydır.", example: "İşler karışırsa sesimi yükseltip 'Herkes beni dinlesin, şöyle yapıyoruz' diyebilirim.", function: 'E' }, 
        right: { text: "Başkalarına ne yapacaklarını söylemek veya baskın davranmak bana doğal gelmez.", example: "Fikrim olsa bile, başkalarıyla çatışmaya girmektense sessiz kalabilirim.", function: 'I' } 
      },
      { 
        id: 24, 
        left: { text: "Kaotik, gürültülü ve çok uyaranlı ortamlarda bile işlevsel kalabilirim.", example: "Arka planda yüksek sesli müzik veya konuşmalar varken dikkatim dağılmadan çalışabilirim.", function: 'E' }, 
        right: { text: "Gürültü ve karmaşa zihnimi hemen yorar, odaklanmamı engeller.", example: "Etrafımda çok fazla hareket veya ses varsa, düşüncelerimi toparlayabilmek için oradan uzaklaşmam gerekir.", function: 'I' } 
      },
      { 
        id: 25, 
        left: { text: "Duygularımı, kahkahamı ve heyecanımı dışarıya yansıtmaktan çekinmem.", example: "Komik bir şey olduğunda sesli gülerim ve konuşurken el-kol hareketlerini bolca kullanırım.", function: 'E' }, 
        right: { text: "Dışarıdan bakıldığında sakin, kontrollü ve mesafeli görünürüm.", example: "İçimden çok sevinsem veya kızsam bile, yüz ifadem ve beden dilim genelde nötr kalır.", function: 'I' } 
      }
    ];

    // MBTI Types and their function stacks
    const MBTI_STACKS = {
      ISTJ: ['Si', 'Te', 'Fi', 'Ne', 'Se', 'Ti', 'Fe', 'Ni'],
      ISFJ: ['Si', 'Fe', 'Ti', 'Ne', 'Se', 'Fi', 'Te', 'Ni'],
      INFJ: ['Ni', 'Fe', 'Ti', 'Se', 'Ne', 'Fi', 'Te', 'Si'],
      INTJ: ['Ni', 'Te', 'Fi', 'Se', 'Ne', 'Ti', 'Fe', 'Si'],
      ISTP: ['Ti', 'Se', 'Ni', 'Fe', 'Te', 'Si', 'Ne', 'Fi'],
      ISFP: ['Fi', 'Se', 'Ni', 'Te', 'Fe', 'Si', 'Ne', 'Ti'],
      INFP: ['Fi', 'Ne', 'Si', 'Te', 'Fe', 'Ni', 'Se', 'Ti'],
      INTP: ['Ti', 'Ne', 'Si', 'Fe', 'Te', 'Ni', 'Se', 'Fi'],
      ESTP: ['Se', 'Ti', 'Fe', 'Ni', 'Si', 'Te', 'Fi', 'Ne'],
      ESFP: ['Se', 'Fi', 'Te', 'Ni', 'Si', 'Fe', 'Ti', 'Ne'],
      ENFP: ['Ne', 'Fi', 'Te', 'Si', 'Ni', 'Fe', 'Ti', 'Se'],
      ENTP: ['Ne', 'Ti', 'Fe', 'Si', 'Ni', 'Te', 'Fi', 'Se'],
      ESTJ: ['Te', 'Si', 'Ne', 'Fi', 'Ti', 'Se', 'Ni', 'Fe'],
      ESFJ: ['Fe', 'Si', 'Ne', 'Ti', 'Fi', 'Se', 'Ni', 'Te'],
      ENFJ: ['Fe', 'Ni', 'Se', 'Ti', 'Fi', 'Ne', 'Si', 'Te'],
      ENTJ: ['Te', 'Ni', 'Se', 'Fi', 'Ti', 'Ne', 'Si', 'Fe'],
    };

    // Weights for the 8 positions
    const POSITION_WEIGHTS = [1, 0.9, 0.75, 0.5, 0, 0, 0, 0];

    // Function names for display
    const FUNCTION_NAMES = {
      Te: 'Dışa Dönük Düşünme (Te)',
      Ti: 'İçe Dönük Düşünme (Ti)',
      Fe: 'Dışa Dönük Hissetme (Fe)',
      Fi: 'İçe Dönük Hissetme (Fi)',
      Se: 'Dışa Dönük Algılama (Se)',
      Si: 'İçe Dönük Algılama (Si)',
      Ne: 'Dışa Dönük Sezgi (Ne)',
      Ni: 'İçe Dönük Sezgi (Ni)',
      E: 'Dışadönüklük (E)'
    };

    // ========== Test State ==========
    let currentStep = 0;
    let answers = {}; // { questionId: likertValue (1-5) }
    let maxStepReached = 0;
    let userEmail = '';
    let isAnimating = false;

    // ========== DOM Elements ==========
    const startScreen = document.getElementById('startScreen');
    const testArea = document.getElementById('testArea');
    const questionArea = document.getElementById('questionArea');
    const resultsContainer = document.getElementById('resultsContainer');
    const emailModal = document.getElementById('emailModal');
    const bottomContainer = document.getElementById('bottomContainer');
    const progressFill = document.getElementById('progressFill');
    const currentQSpan = document.getElementById('currentQ');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const likertScale = document.getElementById('likertScale');

    // ========== Core Functions ==========
    function startTest() {
      startScreen.style.display = 'none';
      testArea.classList.add('active');
      bottomContainer.style.display = 'block';
      renderLikertScale();
      renderQuestion();
    }

    function renderLikertScale() {
      const sizeClasses = ['size-lg', 'size-md', 'size-sm', 'size-md', 'size-lg'];
      let html = '';
      for (let i = 1; i <= 5; i++) {
        html += `<button class="likert-btn ${sizeClasses[i-1]}" data-value="${i}" onclick="handleAnswer(${i})"></button>`;
      }
      likertScale.innerHTML = html;
    }

    function updateLikertSelection() {
      const pair = MBTI_PAIRS[currentStep];
      const selectedValue = answers[pair.id];
      
      document.querySelectorAll('.likert-btn').forEach(btn => {
        const value = parseInt(btn.dataset.value);
        btn.classList.remove('selected', 'selected-1', 'selected-2', 'selected-3', 'selected-4', 'selected-5');
        if (value === selectedValue) {
          btn.classList.add('selected', `selected-${value}`);
        }
      });
    }

    function renderQuestion() {
      const pair = MBTI_PAIRS[currentStep];
      if (!pair) return;

      // Update progress
      const progress = ((currentStep + 1) / MBTI_PAIRS.length) * 100;
      progressFill.style.width = progress + '%';
      currentQSpan.textContent = currentStep + 1;
      document.getElementById('totalQ').textContent = MBTI_PAIRS.length;

      // Update nav buttons
      prevBtn.disabled = currentStep === 0;
      const isReviewing = currentStep < maxStepReached;
      nextBtn.style.visibility = (isReviewing && answers[pair.id] !== undefined && currentStep < MBTI_PAIRS.length - 1) ? 'visible' : 'hidden';

      // Determine selection state
      const selectedValue = answers[pair.id];
      const isLeftSelected = selectedValue === 1 || selectedValue === 2;
      const isRightSelected = selectedValue === 4 || selectedValue === 5;

      // Build question HTML
      questionArea.innerHTML = `
        <div class="question-slide">
          <div class="choices-container">
            <!-- Left Box (A) -->
            <div class="question-box ${isLeftSelected ? 'selected-a' : ''}" onclick="handleAnswer(1)">
              <div class="badge badge-a">A</div>
              <div class="question-text ${isLeftSelected ? 'selected' : ''}">${pair.left.text}</div>
              <div class="example-text">
                <span class="example-label">Örneğin: </span>
                <span class="example-content">${pair.left.example}</span>
              </div>
            </div>

            <!-- Ya da -->
            <div class="yada-container">
              <span class="yada-text">Ya da</span>
            </div>

            <!-- Right Box (B) -->
            <div class="question-box ${isRightSelected ? 'selected-b' : ''}" onclick="handleAnswer(5)">
              <div class="badge badge-b">B</div>
              <div class="question-text ${isRightSelected ? 'selected' : ''}">${pair.right.text}</div>
              <div class="example-text">
                <span class="example-label">Örneğin: </span>
                <span class="example-content">${pair.right.example}</span>
              </div>
            </div>
          </div>
        </div>
      `;

      // Update likert selection
      updateLikertSelection();
    }

    function handleAnswer(value) {
      if (isAnimating) return;
      
      const pair = MBTI_PAIRS[currentStep];
      answers[pair.id] = value;

      // Update UI immediately
      updateLikertSelection();
      
      // Update question box selection
      const selectedValue = answers[pair.id];
      const isLeftSelected = selectedValue === 1 || selectedValue === 2;
      const isRightSelected = selectedValue === 4 || selectedValue === 5;
      
      const boxes = document.querySelectorAll('.question-box');
      boxes[0].classList.toggle('selected-a', isLeftSelected);
      boxes[1].classList.toggle('selected-b', isRightSelected);

      // Move to next question or finish
      if (currentStep < MBTI_PAIRS.length - 1) {
        animateToNext();
      } else {
        finishTest();
      }
    }

    function animateToNext() {
      if (isAnimating) return;
      isAnimating = true;

      const slide = questionArea.querySelector('.question-slide');
      if (slide) slide.classList.add('slide-out-left');

      setTimeout(() => {
        currentStep++;
        if (currentStep > maxStepReached) {
          maxStepReached = currentStep;
        }
        renderQuestion();
        isAnimating = false;
      }, 250);
    }

    function animateToPrevious() {
      if (isAnimating) return;
      isAnimating = true;

      const slide = questionArea.querySelector('.question-slide');
      if (slide) slide.classList.add('slide-out-right');

      setTimeout(() => {
        currentStep--;
        renderQuestion();
        isAnimating = false;
      }, 250);
    }

    function goToPrevious() {
      if (currentStep > 0 && !isAnimating) {
        animateToPrevious();
      }
    }

    function goToNext() {
      const pair = MBTI_PAIRS[currentStep];
      if (currentStep < MBTI_PAIRS.length - 1 && answers[pair.id] !== undefined && !isAnimating) {
        animateToNext();
      }
    }

    function finishTest() {
      // Show email modal
      testArea.classList.remove('active');
      bottomContainer.style.display = 'none';
      emailModal.classList.add('active');
    }

    function submitEmail() {
      const emailInput = document.getElementById('emailInput');
      userEmail = emailInput.value.trim();
      
      if (userEmail) {
        localStorage.setItem('typo_mbti_email', userEmail);
      }
      
      showResults();
    }

    function skipEmail() {
      showResults();
    }

    function showResults() {
      emailModal.classList.remove('active');
      resultsContainer.classList.add('active');

      // Calculate result
      const result = calculateResult();
      
      // Update title
      document.getElementById('resultTitle').textContent = result.type;

      // Build scores HTML
      const scoresContainer = document.getElementById('resultScores');
      let scoresHTML = '';
      
      // Add extraversion first
      scoresHTML += `
        <div class="score-item">
          <span class="score-label">${FUNCTION_NAMES['E']}</span>
          <div class="score-bar-container">
            <div class="score-bar" style="width: 0%" data-target="${result.extraversion_percent}"></div>
          </div>
          <span class="score-value">${result.extraversion_percent}%</span>
        </div>
      `;

      // Add cognitive functions sorted by value
      const sortedFunctions = Object.entries(result.functions)
        .filter(([key]) => key !== 'extraversion_percent')
        .sort((a, b) => b[1] - a[1]);

      for (const [func, value] of sortedFunctions) {
        scoresHTML += `
          <div class="score-item">
            <span class="score-label">${FUNCTION_NAMES[func]}</span>
            <div class="score-bar-container">
              <div class="score-bar" style="width: 0%" data-target="${value}"></div>
            </div>
            <span class="score-value">${value}</span>
          </div>
        `;
      }

      scoresContainer.innerHTML = scoresHTML;

      // Animate score bars
      setTimeout(() => {
        document.querySelectorAll('.score-bar').forEach(bar => {
          bar.style.width = bar.dataset.target + '%';
        });
      }, 100);

      // Save to localStorage
      localStorage.setItem('typo_mbti_result', JSON.stringify({
        type: result.type,
        functions: result.functions,
        extraversion_percent: result.extraversion_percent,
        timestamp: new Date().toISOString()
      }));
    }

    function calculateResult() {
      // 1. Calculate raw function scores
      const scores = {
        Te: 0, Ti: 0, Fe: 0, Fi: 0, Se: 0, Si: 0, Ne: 0, Ni: 0, E: 0, I: 0
      };

      MBTI_PAIRS.forEach(pair => {
        const val = answers[pair.id] ?? 3; // Default to 3 if missing

        let leftPoints = 0;
        let rightPoints = 0;

        if (val === 1) { leftPoints = 2; rightPoints = 0; }
        else if (val === 2) { leftPoints = 1.5; rightPoints = 0.5; }
        else if (val === 3) { leftPoints = 1; rightPoints = 1; }
        else if (val === 4) { leftPoints = 0.5; rightPoints = 1.5; }
        else if (val === 5) { leftPoints = 0; rightPoints = 2; }

        scores[pair.left.function] += leftPoints;
        scores[pair.right.function] += rightPoints;
      });

      // 2. Calculate Type Scores
      let bestType = '';
      let maxScore = -1;

      Object.entries(MBTI_STACKS).forEach(([type, stack]) => {
        let typeScore = 0;
        stack.forEach((func, index) => {
          const weight = POSITION_WEIGHTS[index];
          typeScore += (scores[func] || 0) * weight;
        });

        if (typeScore > maxScore) {
          maxScore = typeScore;
          bestType = type;
        }
      });

      // 3. Calculate Extraversion Percent
      const totalE = scores.E;
      const totalI = scores.I;
      const totalAttitude = totalE + totalI;
      const extraversion_percent = totalAttitude > 0 ? Math.round((totalE / totalAttitude) * 100) : 50;

      // 4. Override E/I based on E vs I question results
      const isExtravert = extraversion_percent >= 60;
      const currentFirstLetter = bestType.charAt(0);
      let finalType = bestType;
      
      if (isExtravert && currentFirstLetter === 'I') {
        finalType = 'E' + bestType.slice(1);
      } else if (!isExtravert && currentFirstLetter === 'E') {
        finalType = 'I' + bestType.slice(1);
      }

      // 5. Prepare result object
      const functions = {
        Te: Math.round(scores.Te * 10),
        Ti: Math.round(scores.Ti * 10),
        Fe: Math.round(scores.Fe * 10),
        Fi: Math.round(scores.Fi * 10),
        Se: Math.round(scores.Se * 10),
        Si: Math.round(scores.Si * 10),
        Ne: Math.round(scores.Ne * 10),
        Ni: Math.round(scores.Ni * 10)
      };

      return {
        type: finalType,
        functions,
        extraversion_percent
      };
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') goToPrevious();
      if (e.key === 'ArrowRight') goToNext();
      if (e.key >= '1' && e.key <= '5') {
        handleAnswer(parseInt(e.key));
      }
    });

    // Set year in footer
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
